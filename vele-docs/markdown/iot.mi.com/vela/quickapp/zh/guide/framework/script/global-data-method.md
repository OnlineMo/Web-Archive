::: {#app server-rendered="true"}
::: theme-container
::: navbar
::: sidebar-button
![](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGFyaWEtaGlkZGVuPSJ0cnVlIiByb2xlPSJpbWciIHZpZXdib3g9IjAgMCA0NDggNTEyIiBjbGFzcz0iaWNvbiI+PHBhdGggZmlsbD0iY3VycmVudENvbG9yIiBkPSJNNDM2IDEyNEgxMmMtNi42MjcgMC0xMi01LjM3My0xMi0xMlY4MGMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6bTAgMTYwSDEyYy02LjYyNyAwLTEyLTUuMzczLTEyLTEydi0zMmMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6bTAgMTYwSDEyYy02LjYyNyAwLTEyLTUuMzczLTEyLTEydi0zMmMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6Ij48L3BhdGg+PC9zdmc+){.icon}
:::

[![Xiaomi Vela JS 应用开发文档](../../../../logo.png){.logo} [Xiaomi
Vela JS 应用开发文档]{.site-name
.can-hide}](https://iot.mi.com/vela/quickapp/){.home-link
.router-link-active}

::: links
::: search-box
:::

::: nav-item
[教程](../../version/APILevel4.html){.nav-link .router-link-active}
:::

::: nav-item
[组件](../../../components/index.html){.nav-link}
:::

::: nav-item
[JS接口](../../../features/index.html){.nav-link}
:::

::: nav-item
[编程示例](../../../samples/index.html){.nav-link}
:::

::: nav-item
[工具](../../../tools/index.html){.nav-link}
:::
:::
:::

::: sidebar-mask
:::

::: nav-item
[教程](../../version/APILevel4.html){.nav-link .router-link-active}
:::

::: nav-item
[组件](../../../components/index.html){.nav-link}
:::

::: nav-item
[JS接口](../../../features/index.html){.nav-link}
:::

::: nav-item
[编程示例](../../../samples/index.html){.nav-link}
:::

::: nav-item
[工具](../../../tools/index.html){.nav-link}
:::

-   ::: {.section .sidebar-group .depth-0}
    [快速入门](https://iot.mi.com/vela/quickapp/zh/guide/start){.sidebar-heading
    .clickable}
    -   [安装环境](../../start/use-ide.html){.sidebar-link}
    -   [项目结构](../../start/project-overview.html){.sidebar-link}
    -   [编写页面UI](../../start/user-interface.html){.sidebar-link}
    -   [添加交互](../../start/add-interactivity.html){.sidebar-link}
    -   [数据获取](../../start/data-fetch.html){.sidebar-link}
    -   [编译参数](../../start/toolkit-params.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [基础功能](../index.html){.sidebar-heading .clickable
    .router-link-active .open}
    -   [项目结构](../project-structure.html){.sidebar-link}

    -   [项目配置](../manifest.html){.sidebar-link}

    -   [UX 文件](../ux.html){.sidebar-link}

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [模板语法 []{.arrow
        .right}](../template/index.html){.sidebar-heading .clickable}
        :::

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [样式语法 []{.arrow
        .right}](../style/index.html){.sidebar-heading .clickable}
        :::

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [脚本语法 []{.arrow .down}](index.html){.sidebar-heading
        .clickable .router-link-active .open}
        -   [全局属性和方法](global-data-method.html){.active
            .sidebar-link aria-current="page"}
        -   [页面数据对象](page-data.html){.sidebar-link}
        -   [生命周期](lifecycle.html){.sidebar-link}
        :::

    -   [页面切换](../page-switch.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [进阶功能](../other/index.html){.sidebar-heading .clickable}
    -   [多语言覆盖](../other/i18n.html){.sidebar-link}

    -   [后台运行](../other/background-running.html){.sidebar-link}

    -   [hap 链接](../other/hap-schema.html){.sidebar-link}

    -   [页面启动模式](../other/launch-mode.html){.sidebar-link}

    -   ::: {.section .sidebar-group .is-sub-group .depth-1}
        [多屏适配](../../multi-screens/index.html){.sidebar-heading
        .clickable}
        -   [适配规范](../../multi-screens/specs.html){.sidebar-link}
        -   [代码示例](../../multi-screens/samples.html){.sidebar-link}
        -   [条件编译](../../multi-screens/conditional-compilation.html){.sidebar-link}
        :::
    :::

-   ::: {.section .sidebar-group .depth-0}
    [开发者物料](../../developer-materials/index.html){.sidebar-heading
    .clickable}
    -   [拓展组件](../../developer-materials/extension-components.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [设计指南](../../design/index.html){.sidebar-heading .clickable}
    -   [多屏设计](../../design/multi-screens.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [最佳实践](../../best-practice/index.html){.sidebar-heading
    .clickable}
    -   [内存优化](../../best-practice/memory.html){.sidebar-link}
    -   [常用业务优化](../../best-practice/business.html){.sidebar-link}
    -   [启动时延优化](../../best-practice/start.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [发布](../../publish/index.html){.sidebar-heading .clickable}
    -   [验收标准](../../publish/acceptance-criteria.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [版本说明](../../version/index.html){.sidebar-heading .clickable}
    -   [APILevel2](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel2.html){.sidebar-link}
    -   [APILevel3](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel3.html){.sidebar-link}
    -   [APILevel4](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel4.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    其他

    -   [常见问题](../../other/faq.html){.sidebar-link}
    -   [注意事项](../../other/tips.html){.sidebar-link}
    :::

::: {.page role="main"}
::: {.theme-default-content .content__default}
# [\#](global-data-method.html#全局属性和方法){.header-anchor} 全局属性和方法

## [\#](global-data-method.html#对象){.header-anchor} 对象

### [\#](global-data-method.html#公共对象){.header-anchor} 公共对象

  属性      类型      描述
  --------- --------- ------------------
  \$app     Object    应用对象
  \$page    Object    页面对象
  \$valid   Boolean   页面对象是否有效

#### [\#](global-data-method.html#应用对象){.header-anchor} 应用对象

在页面中可通过 \$app 访问到全局应用对象。

在`app.ux`文件中，开发者可以定义全局可访问的数据和方法，在页面中通过`this.$app.$def`访问，在`app.ux`文件中，直接通过`this`访问。例如在`app.ux`文件中定义如下：

::: {.language-html .extra-class}
``` language-html
<script>
/**
 * 应用级别的配置，供所有页面公用
 */
export default {
  data: {
    a: 1
  },
  func: function() {
    console.log(this.data.a)
    console.log(`function executed!`)
  }
}
</script>
```
:::

在其他页面可以这样调用：

::: {.language-javascript .extra-class}
``` language-javascript
this.$app.$def.data
this.$app.$def.func()
```
:::

可通过 \$app 访问如下内置方法：

  属性   类型       描述
  ------ ---------- -------------------------------------------------------------
  exit   Function   退出 JS 应用，结束应用生命周期。调用方法：this.\$app.exit()

#### [\#](global-data-method.html#页面对象){.header-anchor} 页面对象

在页面中可通过this.\$page访问到当前页面对象，该对象上可访问到如下属性：

  属性        类型     描述
  ----------- -------- -------------------------------------------------------------------------------------
  name        String   获取当前页面路由的名称，与manifest 文件中router.pages 中对应的属性名一致
  path        String   获取当前页面路由的 path，与manifest 文件中router.pages 中对应的 path 一致
  component   String   获取当前页面路由的 component，与manifest 文件中router.pages 中对应的 component 一致

## [\#](global-data-method.html#方法){.header-anchor} 方法

### [\#](global-data-method.html#this-caniuse){.header-anchor} this.\$canIUse[[3+]{.badge .apilevel style="vertical-align:top;" v-15b7b770=""}](../../version/APILevel3.html){.apilevel-a} {#this-caniuse}

在页面中可通过 this.\$canIUse 进行可使用的能力查询，包括接口和组件。

#### [\#](global-data-method.html#参数){.header-anchor} 参数:

  类型     描述
  -------- --------------------------
  String   要查询的能力，格式见下方

#### [\#](global-data-method.html#返回值){.header-anchor} 返回值：

  类型      描述
  --------- --------------------
  Boolean   查询的能力是否支持

#### [\#](global-data-method.html#入参格式){.header-anchor} 入参格式

##### [\#](global-data-method.html#查询接口){.header-anchor} 查询接口

::: {.language-javascript .extra-class}
``` language-javascript
// 查询feature下的方法是否支持
`@${featureName}.${method}`
// 查询某个feature是否支持
`@${featureName}`
```
:::

**示例**

::: {.language-javascript .extra-class}
``` language-javascript
if (this.$canIUse('@system.router.push')) {
  // 可以使用方法@system.router.push
}
if (this.$canIUse('@system.router')) {
  // 可以使用@system.router接口
}
```
:::

##### [\#](global-data-method.html#查询组件){.header-anchor} 查询组件

type取值可以是`'attr'`、`'style'`、`'method'`，分别对应组件的属性、样式、方法。

::: {.language-javascript .extra-class}
``` language-javascript
// 查询组件下的属性、样式、方法是否支持
`${componentName}.${type}.${name}`
// 查询组件是否支持
`${componentName}`
```
:::

**示例**

::: {.language-javascript .extra-class}
``` language-javascript
if (this.$canIUse('scroll')) {
  // 可以使用scroll组件
}
if (this.$canIUse('scroll.attr.scroll-x')) {
  // 可以使用scroll组件的scroll-x属性
}
```
:::

### [\#](global-data-method.html#this-watch){.header-anchor} this.\$watch {#this-watch}

监控数据改变。动态添加属性/事件绑定，属性必须在 data 中定义，handler
函数必须在`<script>`定义，当属性值发生变化时事件被触发。\
如果是监听对象中的属性，参数请使用.分割，如：\$watch(xxx.xxx.xxx,
methodName)。

#### [\#](global-data-method.html#参数-2){.header-anchor} 参数 {#参数-2}

  属性      类型     描述
  --------- -------- --------------------------------------------------------------------
  data      String   属性名，支持\'a.b.c\'格式，不支持数组索引
  handler   String   事件句柄函数名，函数的第一个参数为新属性值，第二个参数为旧的属性值

#### [\#](global-data-method.html#代码示例){.header-anchor} 代码示例

::: {.language-html .extra-class}
``` language-html
<script>
  export default {
    props: ['propObject'],
    data {
      say: '',
      propSay: ''
    },
    onInit() {
      // 监听数据变化
      this.$watch('say', 'watchDataChange')
      this.$watch('propObject.name', 'watchPropsChange')
    },
    /**
     * 监听数据变化，你可以对数据处理后，设置值到data上
     * @param newV
     * @param oldV
     */
    watchPropsChange(newV, oldV) {
      console.info(`监听数据变化：`, newV, oldV)
      this.propSay = newV && newV.toUpperCase()
    },
    watchDataChange(newV, oldV) {
      console.info(`监听数据变化：`, newV, oldV)
    }
  }
</script>
```
:::

### [\#](global-data-method.html#this-element){.header-anchor} this.\$element {#this-element}

获取指定 id 的组件 dom 对象，如果没有指定 id，则返回根组件 dom 对象。

#### [\#](global-data-method.html#参数-3){.header-anchor} 参数 {#参数-3}

  类型     描述
  -------- -----------------------------------------
  String   this.\$element(\'idName\')获取 dom 节点

#### [\#](global-data-method.html#代码示例-2){.header-anchor} 代码示例 {#代码示例-2}

::: {.language-html .extra-class}
``` language-html
<template>
  <div>
    <div id='xxx'></div>
  </div>
</template>

<script>
  export default {
    onReady() {
      const el = this.$element('xxx')
      console.log(`输出xxx节点信息： ${el}`)
    }
  }
</script>
```
:::

this.\$element(\'xxx\') 获取 id 为 xxx 的 div 组件实例对象，
this.\$element() 获取模板中的根组件实例对象。

`id`属性赋值可以查看此[文档](../../../components/general/properties.html)。

### [\#](global-data-method.html#this-nexttick){.header-anchor} this.\$nextTick {#this-nexttick}

在下次 DOM
更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，可以获取更新后DOM。

#### [\#](global-data-method.html#参数-4){.header-anchor} 参数 {#参数-4}

  类型       描述
  ---------- -----------------------------------------
  Function   回调函数中执行的是会对DOM进行操作的处理

#### [\#](global-data-method.html#代码示例-3){.header-anchor} 代码示例 {#代码示例-3}

::: {.language-html .extra-class}
``` language-html
<template>
  <div class="page">
    <text @click="onAddClick">添加项目</text>
    <div class="list" id="list">
      <div class="item" for="{{list}}">
        <text>{{ $item }}</text>
      </div>
    </div>
  </div>
</template>

<script>
  export default {
    private: {
      list: ["项目1", "项目2"]
    },
    onAddClick() {
      this.list.push(Math.random())
      // 更新数据后,DOM没有立即发生变化。
      this.$element("list").getBoundingClientRect({
        success: (rect) => {
          console.log("getBoundingClientRect.height=", rect.height)
        }
      })
      this.$nextTick(() => {
        // 更新数据后,DOM发生变化。
        this.$element("list").getBoundingClientRect({
          success: (rect) => {
            console.log("$nextTick getBoundingClientRect.height=", rect.height)
          }
        })
      })
    }
  }
</script>
<style>
  .page {
    padding-top: 20px;
    width: 100%;
    height: 100%;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
  }

  .list {
    width: 200px;
    flex-direction: column;
    align-items: center;
    border: 2px solid red;
  }
</style>
```
:::

除了以上公共方法，还有this.\$on、this.\$off、this.\$dispatch、this.\$broadcast、this.\$emit等事件方法用于父子组件通信。方法说明如下：

  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  方法                    参数                    描述
  ----------------------- ----------------------- ----------------------------------------------------------------------------------------------------------------------------------------------
  this.\$on               type: String 事件名\    添加事件处理句柄用法：this.\$on(\'xxxx\', this.fn)，fn 是在\<script\>中定义的函数
                          handler: Function       
                          事件句柄函数            

  this.\$off              type: String 事件名\    删除事件处理句柄用法：this.\$off(\'xxxx\', this.fn) this.\$off(\'xxx\') 删除指定事件的所有处理句柄
                          handler: Function       
                          事件句柄函数            

  this.\$dispatch         type: String 事件名     向上层组件发送事件通知用法：this.\$dispatch(\'xxx\')正常情况下，会一直向上传递事件（冒泡）如果要停止冒泡，在事件句柄函数中调用evt.stop()即可

  this.\$broadcast        type: String 事件名     向子组件发送事件通知用法：this.\$broadcast(\'xxx\')正常情况下，会一直向下传递事件如果要停止传递，在事件句柄函数中调用evt.stop()即可

  this.\$emit             type: String 事件名\    触发事件，对应的句柄函数被调用用法：this.\$emit(\'xxx\') this.\$emit(\'xxx\',
                          data: Object 事件参数   {a:1})传递的事件参数可在事件回调函数中，通过evt.detail来访问，例如evt.detail.a
  ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

事件方法使用示例可参考[文档](../template/component.html#父子组件通信)。
:::

::: page-nav
[ ← [媒体查询](../style/media-query.html){.prev} ]{.prev} [
[页面数据对象](page-data.html) → ]{.next}
:::
:::

::: toc
::: on-this-page
快速导航
:::

::: {.vuepress-toc-item .vuepress-toc-h2 .active}
[对象](global-data-method.html#对象 "对象")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[公共对象](global-data-method.html#公共对象 "公共对象")
:::

::: {.vuepress-toc-item .vuepress-toc-h2}
[方法](global-data-method.html#方法 "方法")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[this.\$canIUse](global-data-method.html#this-caniuse "this.$canIUse")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[this.\$watch](global-data-method.html#this-watch "this.$watch")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[this.\$element](global-data-method.html#this-element "this.$element")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[this.\$nextTick](global-data-method.html#this-nexttick "this.$nextTick")
:::
:::
:::

::: global-ui
:::
:::
