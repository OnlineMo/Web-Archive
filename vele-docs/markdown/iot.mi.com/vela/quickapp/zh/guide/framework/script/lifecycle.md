::: {#app server-rendered="true"}
::: theme-container
::: navbar
::: sidebar-button
![](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGFyaWEtaGlkZGVuPSJ0cnVlIiByb2xlPSJpbWciIHZpZXdib3g9IjAgMCA0NDggNTEyIiBjbGFzcz0iaWNvbiI+PHBhdGggZmlsbD0iY3VycmVudENvbG9yIiBkPSJNNDM2IDEyNEgxMmMtNi42MjcgMC0xMi01LjM3My0xMi0xMlY4MGMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6bTAgMTYwSDEyYy02LjYyNyAwLTEyLTUuMzczLTEyLTEydi0zMmMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6bTAgMTYwSDEyYy02LjYyNyAwLTEyLTUuMzczLTEyLTEydi0zMmMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6Ij48L3BhdGg+PC9zdmc+){.icon}
:::

[![Xiaomi Vela JS 应用](../../../../logo.png){.logo} [Xiaomi Vela JS
应用]{.site-name
.can-hide}](https://iot.mi.com/vela/quickapp/){.home-link
.router-link-active}

::: links
::: search-box
:::

::: nav-item
[教程](../../version/APILevel4.html){.nav-link .router-link-active}
:::

::: nav-item
[组件](../../../components/index.html){.nav-link}
:::

::: nav-item
[JS接口](../../../features/index.html){.nav-link}
:::

::: nav-item
[编程示例](../../../samples/index.html){.nav-link}
:::

::: nav-item
[工具](../../../tools/index.html){.nav-link}
:::

::: nav-item
::: dropdown-wrapper
[选择语言]{.title} []{.arrow .down}

[选择语言]{.title} []{.arrow .right}

-   [简体中文](lifecycle.html){.nav-link .router-link-exact-active
    .router-link-active aria-current="page"}
-   [English](https://iot.mi.com/vela/quickapp/en/guide/framework/script/lifecycle.html){.nav-link}
:::
:::
:::
:::

::: sidebar-mask
:::

::: nav-item
[教程](../../version/APILevel4.html){.nav-link .router-link-active}
:::

::: nav-item
[组件](../../../components/index.html){.nav-link}
:::

::: nav-item
[JS接口](../../../features/index.html){.nav-link}
:::

::: nav-item
[编程示例](../../../samples/index.html){.nav-link}
:::

::: nav-item
[工具](../../../tools/index.html){.nav-link}
:::

::: nav-item
::: dropdown-wrapper
[选择语言]{.title} []{.arrow .down}

[选择语言]{.title} []{.arrow .right}

-   [简体中文](lifecycle.html){.nav-link .router-link-exact-active
    .router-link-active aria-current="page"}
-   [English](https://iot.mi.com/vela/quickapp/en/guide/framework/script/lifecycle.html){.nav-link}
:::
:::

-   ::: {.section .sidebar-group .depth-0}
    [快速入门](https://iot.mi.com/vela/quickapp/zh/guide/start){.sidebar-heading
    .clickable}
    -   [安装环境](../../start/use-ide.html){.sidebar-link}
    -   [项目结构](../../start/project-overview.html){.sidebar-link}
    -   [编写页面UI](../../start/user-interface.html){.sidebar-link}
    -   [添加交互](../../start/add-interactivity.html){.sidebar-link}
    -   [数据获取](../../start/data-fetch.html){.sidebar-link}
    -   [编译参数](../../start/toolkit-params.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [基础功能](../index.html){.sidebar-heading .clickable
    .router-link-active .open}
    -   [项目结构](../project-structure.html){.sidebar-link}

    -   [项目配置](../manifest.html){.sidebar-link}

    -   [UX 文件](../ux.html){.sidebar-link}

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [模板语法 []{.arrow
        .right}](../template/index.html){.sidebar-heading .clickable}
        :::

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [样式语法 []{.arrow
        .right}](../style/index.html){.sidebar-heading .clickable}
        :::

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [脚本语法 []{.arrow .down}](index.html){.sidebar-heading
        .clickable .router-link-active .open}
        -   [全局属性和方法](global-data-method.html){.sidebar-link}
        -   [页面数据对象](page-data.html){.sidebar-link}
        -   [生命周期](lifecycle.html){.active .sidebar-link
            aria-current="page"}
        :::

    -   [页面切换](../page-switch.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [进阶功能](../other/index.html){.sidebar-heading .clickable}
    -   [多语言覆盖](../other/i18n.html){.sidebar-link}

    -   [后台运行](../other/background-running.html){.sidebar-link}

    -   [hap 链接](../other/hap-schema.html){.sidebar-link}

    -   [页面启动模式](../other/launch-mode.html){.sidebar-link}

    -   ::: {.section .sidebar-group .is-sub-group .depth-1}
        [多屏适配](../../multi-screens/index.html){.sidebar-heading
        .clickable}
        -   [适配规范](../../multi-screens/specs.html){.sidebar-link}
        -   [代码示例](../../multi-screens/samples.html){.sidebar-link}
        -   [条件编译](../../multi-screens/conditional-compilation.html){.sidebar-link}
        :::
    :::

-   ::: {.section .sidebar-group .depth-0}
    [开发者物料](../../developer-materials/index.html){.sidebar-heading
    .clickable}
    -   [拓展组件](../../developer-materials/extension-components.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [设计指南](../../design/index.html){.sidebar-heading .clickable}
    -   [多屏设计](../../design/multi-screens.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [最佳实践](../../best-practice/index.html){.sidebar-heading
    .clickable}
    -   [内存优化](../../best-practice/memory.html){.sidebar-link}
    -   [常用业务优化](../../best-practice/business.html){.sidebar-link}
    -   [启动时延优化](../../best-practice/start.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [发布](../../publish/index.html){.sidebar-heading .clickable}
    -   [验收标准](../../publish/acceptance-criteria.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [版本说明](../../version/index.html){.sidebar-heading .clickable}
    -   [APILevel2](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel2.html){.sidebar-link}
    -   [APILevel3](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel3.html){.sidebar-link}
    -   [APILevel4](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel4.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    其他

    -   [常见问题](../../other/faq.html){.sidebar-link}
    -   [注意事项](../../other/tips.html){.sidebar-link}
    :::

::: {.page role="main"}
::: {.theme-default-content .content__default}
# [\#](lifecycle.html#生命周期){.header-anchor} 生命周期

-   [页面的生命周期](lifecycle.html#%E9%A1%B5%E9%9D%A2%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F)：`onInit`、`onReady`、`onShow`、`onHide`、`onDestroy`、`onBackPress`、`onRefresh`、`onConfigurationChanged`
-   页面的状态：`显示`、`隐藏`、`销毁`
-   [APP
    的生命周期](lifecycle.html#app%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F)：`onCreate`、`onShow`、`onHide`、`onDestroy`
    、`onError`

## [\#](lifecycle.html#生命周期图){.header-anchor} 生命周期图

![生命周期图](../../../../images/components/life.png)

## [\#](lifecycle.html#页面的生命周期){.header-anchor} 页面的生命周期

由于页面通过`ViewModel`渲染，那么页面的生命周期指的也就是`ViewModel`的生命周期，包括常见的：onInit,
onReady, onShow 在**页面创建**时触发调用。

### [\#](lifecycle.html#oninit){.header-anchor} onInit()

**表示`ViewModel`的数据已经准备好**，可以开始使用页面中的数据。

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
private: {
  // 生命周期的文本列表
  lcList: []
},
onInit () {
  this.lcList.push('onInit')

  console.info(`触发：onInit`)
  // 执行：获取ViewModel的lcList属性：onInit
  console.info(`执行：获取ViewModel的lcList属性：${this.lcList}`)
  // $app信息
  console.info(`获取：manifest.json的config.data的数据：${this.$app.$data.name}`)
  console.info(`获取：APP文件中的数据：${this.$app.$def.data1.name}`)
  console.info(`执行：APP文件中的方法`, this.$app.$def.method1())
}
```
:::

### [\#](lifecycle.html#onready){.header-anchor} onReady()

**表示`ViewModel`的模板已经编译完成**，可以开始获取 DOM
节点（如：`this.$element(idxxx)`）。

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
onReady () {
  this.lcList.push('onReady')
  console.info(`触发：onReady`)
}
```
:::

### [\#](lifecycle.html#onshow-onhide){.header-anchor} onShow(), onHide()

APP
中可以同时运行多个页面，但是**每次只能显示其中一个页面**；这点不同于纯前端开发，浏览器页面中每次只能有一个页面，当前页面打开另一个页面，上个页面就销毁了；不过和
SPA 开发有点相似，切换页面但浏览器全局 Context 是共享的。

所以页面的切换，就产生了新的事件：页面被切换隐藏时调用
onHide()，页面被切换重新显示时调用 onShow()。

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
onShow () {
  this.lcList.push('onShow')
  console.info(`触发：onShow`)
},
onHide () {
  this.lcList.push('onHide')
  console.info(`触发：onHide`)
}
```
:::

### [\#](lifecycle.html#ondestroy){.header-anchor} onDestroy()

页面被销毁时调用，被销毁的可能原因有：用户从当前页面返回到上一页，或者用户打开了太多的页面，框架自动销毁掉部分页面，避免占用资源。

所以，页面销毁时应该做一些**释放资源**的操作，如：取消接口订阅监听`geolocation.unsubscribe()`。

判断页面是否处于被销毁状态，可以调用 `ViewModel` 的 `$valid`
属性：`true` 表示存在，`false` 表示销毁。

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
onDestroy () {
  console.info(`触发：onDestroy`)
  console.info(`执行：页面要被销毁，销毁状态：${this.$valid}，应该做取消接口订阅监听的操作: geolocation.unsubscribe() `) // true，即将销毁
  setTimeout(function () {
    // 页面已销毁，不会执行
    console.info(`执行：页面已被销毁，不会执行`)
  }.bind(this), 0)
}
```
:::

**提示：**

-   `setTimeout`之类的异步操作绑定在了当前页面上，因此当页面销毁之后异步调用不会执行。

### [\#](lifecycle.html#onbackpress){.header-anchor} onBackPress()

当用户`右滑返回`或点击`返回实体按键`时触发该事件。

如果事件响应方法最后返回`true`表示不返回，自己处理业务逻辑（完毕后开发者自行调用
API
返回）；否则：不返回数据，或者返回其它数据，表示遵循系统逻辑：返回到上一页。

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
onBackPress () {
  console.info(`触发：onBackPress`)
  // true：表示自己处理；否则默认返回上一页
  // return true
}
```
:::

### [\#](lifecycle.html#onrefresh-query){.header-anchor} onRefresh(query) {#onrefresh-query}

监听页面重新打开。

1.当页面在 manifest 中 launchMode
标识为\'singleTask\'时，仅会存在一个目标页面实例，用户多次打开目标页面时触发此函数。\
2.打开目标页面时在 push 参数中携带 flag
\'clearTask\'，且页面实例已经存在时触发。该回调中参数为重新打开该页面时携带的参数，详见[页面启动模式](../other/launch-mode.html)。

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
onRefresh(query) {
  // launchMode 为 singleTask 时，重新打开页面时携带的参数不会自动更新到页面 this 对象上
  // 需要在此处从 query 中拿到并手动更新
  console.log('page refreshed!!!')
}
```
:::

### [\#](lifecycle.html#onconfigurationchanged-event){.header-anchor} onConfigurationChanged(event) {#onconfigurationchanged-event}

监听应用配置发生变化。当应用配置发生变化时触发，如系统语言改变。

**参数**

  参数名   类型     描述
  -------- -------- ------------------------
  event    Object   应用配置发生变化的事件

**event参数**

  参数名   类型     描述
  -------- -------- ----------------------------------------------------
  type     String   应用配置发生变化的原因类型，支持的 type 值如下所示

**event 中 type 现在支持的参数值如下**

  参数名   描述
  -------- --------------------------------------
  locale   应用配置因为语言、地区变化而发生改变

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
onConfigurationChanged(evt) {
  console.log(`触发生命周期onConfigurationChanged, 配置类型：${evt.type}`)
}
```
:::

## [\#](lifecycle.html#app的生命周期){.header-anchor} APP的生命周期

当前为 APP
的生命周期提供了五个回调函数：onCreate()、onShow()、onHide()、onDestroy()、onError(e)。

**示例如下：**

::: {.language-javascript .extra-class}
``` language-javascript
export default {
  // 监听应用创建,应用创建时调用
  onCreate() { 
    console.info('Application onCreate')
  },
  // 监听应用返回前台,应用返回前台时调用
  onShow() { 
    console.info('Application onShow')
  },
  // 监听应用退到后台,应用退到后台时调用
  onHide() { 
    console.info('Application onHide')
  },
  // 监听应用销毁,应用销毁时调用
  onDestroy() { 
    console.info('Application onDesteroy')
  },
  // 监听应用报错,应用捕获异常时调用,参数为Error对象。
  onError(e) {
    console.log('Application onError', e)
  },
  // 暴露给所有页面，在页面中通过：this.$app.$def.method1()访问
  method1() {
    console.info('这是APP的方法')
  },
  // 暴露给所有页面，在页面中通过：this.$app.$def.data1访问
  data1: {
    name: '这是APP存的数据'
  }
}
```
:::
:::

::: page-nav
[ ← [页面数据对象](page-data.html){.prev} ]{.prev} [
[页面切换](../page-switch.html) → ]{.next}
:::
:::

::: toc
::: on-this-page
快速导航
:::

::: {.vuepress-toc-item .vuepress-toc-h2 .active}
[生命周期图](lifecycle.html#生命周期图 "生命周期图")
:::

::: {.vuepress-toc-item .vuepress-toc-h2}
[页面的生命周期](lifecycle.html#页面的生命周期 "页面的生命周期")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[onInit()](lifecycle.html#oninit "onInit()")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[onReady()](lifecycle.html#onready "onReady()")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[onShow(), onHide()](lifecycle.html#onshow-onhide "onShow(), onHide()")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[onDestroy()](lifecycle.html#ondestroy "onDestroy()")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[onBackPress()](lifecycle.html#onbackpress "onBackPress()")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[onRefresh(query)](lifecycle.html#onrefresh-query "onRefresh(query)")
:::

::: {.vuepress-toc-item .vuepress-toc-h3}
[onConfigurationChanged(event)](lifecycle.html#onconfigurationchanged-event "onConfigurationChanged(event)")
:::

::: {.vuepress-toc-item .vuepress-toc-h2}
[APP的生命周期](lifecycle.html#app的生命周期 "APP的生命周期")
:::
:::
:::

::: global-ui
:::
:::
