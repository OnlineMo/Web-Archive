::: {#app server-rendered="true"}
::: theme-container
::: navbar
::: sidebar-button
![](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGFyaWEtaGlkZGVuPSJ0cnVlIiByb2xlPSJpbWciIHZpZXdib3g9IjAgMCA0NDggNTEyIiBjbGFzcz0iaWNvbiI+PHBhdGggZmlsbD0iY3VycmVudENvbG9yIiBkPSJNNDM2IDEyNEgxMmMtNi42MjcgMC0xMi01LjM3My0xMi0xMlY4MGMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6bTAgMTYwSDEyYy02LjYyNyAwLTEyLTUuMzczLTEyLTEydi0zMmMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6bTAgMTYwSDEyYy02LjYyNyAwLTEyLTUuMzczLTEyLTEydi0zMmMwLTYuNjI3IDUuMzczLTEyIDEyLTEyaDQyNGM2LjYyNyAwIDEyIDUuMzczIDEyIDEydjMyYzAgNi42MjctNS4zNzMgMTItMTIgMTJ6Ij48L3BhdGg+PC9zdmc+){.icon}
:::

[![Xiaomi Vela JS 应用](../../../logo.png){.logo} [Xiaomi Vela JS
应用]{.site-name
.can-hide}](https://iot.mi.com/vela/quickapp/){.home-link
.router-link-active}

::: links
::: search-box
:::

::: nav-item
[教程](../version/APILevel4.html){.nav-link .router-link-active}
:::

::: nav-item
[组件](../../components/index.html){.nav-link}
:::

::: nav-item
[JS接口](../../features/index.html){.nav-link}
:::

::: nav-item
[编程示例](../../samples/index.html){.nav-link}
:::

::: nav-item
[工具](../../tools/index.html){.nav-link}
:::

::: nav-item
::: dropdown-wrapper
[选择语言]{.title} []{.arrow .down}

[选择语言]{.title} []{.arrow .right}

-   [简体中文](conditional-compilation.html){.nav-link
    .router-link-exact-active .router-link-active aria-current="page"}
-   [English](https://iot.mi.com/vela/quickapp/en/guide/multi-screens/conditional-compilation.html){.nav-link}
:::
:::
:::
:::

::: sidebar-mask
:::

::: nav-item
[教程](../version/APILevel4.html){.nav-link .router-link-active}
:::

::: nav-item
[组件](../../components/index.html){.nav-link}
:::

::: nav-item
[JS接口](../../features/index.html){.nav-link}
:::

::: nav-item
[编程示例](../../samples/index.html){.nav-link}
:::

::: nav-item
[工具](../../tools/index.html){.nav-link}
:::

::: nav-item
::: dropdown-wrapper
[选择语言]{.title} []{.arrow .down}

[选择语言]{.title} []{.arrow .right}

-   [简体中文](conditional-compilation.html){.nav-link
    .router-link-exact-active .router-link-active aria-current="page"}
-   [English](https://iot.mi.com/vela/quickapp/en/guide/multi-screens/conditional-compilation.html){.nav-link}
:::
:::

-   ::: {.section .sidebar-group .depth-0}
    [快速入门](https://iot.mi.com/vela/quickapp/zh/guide/start){.sidebar-heading
    .clickable}
    -   [安装环境](../start/use-ide.html){.sidebar-link}
    -   [项目结构](../start/project-overview.html){.sidebar-link}
    -   [编写页面UI](../start/user-interface.html){.sidebar-link}
    -   [添加交互](../start/add-interactivity.html){.sidebar-link}
    -   [数据获取](../start/data-fetch.html){.sidebar-link}
    -   [编译参数](../start/toolkit-params.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [基础功能](../framework/index.html){.sidebar-heading .clickable}
    -   [项目结构](../framework/project-structure.html){.sidebar-link}

    -   [项目配置](../framework/manifest.html){.sidebar-link}

    -   [UX 文件](../framework/ux.html){.sidebar-link}

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [模板语法 []{.arrow
        .right}](../framework/template/index.html){.sidebar-heading
        .clickable}
        :::

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [样式语法 []{.arrow
        .right}](../framework/style/index.html){.sidebar-heading
        .clickable}
        :::

    -   ::: {.section .sidebar-group .collapsable .is-sub-group .depth-1}
        [脚本语法 []{.arrow
        .right}](../framework/script/index.html){.sidebar-heading
        .clickable}
        :::

    -   [页面切换](../framework/page-switch.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [进阶功能](../framework/other/index.html){.sidebar-heading
    .clickable .open}
    -   [多语言覆盖](../framework/other/i18n.html){.sidebar-link}

    -   [后台运行](../framework/other/background-running.html){.sidebar-link}

    -   [hap 链接](../framework/other/hap-schema.html){.sidebar-link}

    -   [页面启动模式](../framework/other/launch-mode.html){.sidebar-link}

    -   ::: {.section .sidebar-group .is-sub-group .depth-1}
        [多屏适配](index.html){.sidebar-heading .clickable
        .router-link-active .open}
        -   [适配规范](specs.html){.sidebar-link}
        -   [代码示例](samples.html){.sidebar-link}
        -   [条件编译](conditional-compilation.html){.active
            .sidebar-link aria-current="page"}
        :::
    :::

-   ::: {.section .sidebar-group .depth-0}
    [开发者物料](../developer-materials/index.html){.sidebar-heading
    .clickable}
    -   [拓展组件](../developer-materials/extension-components.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [设计指南](../design/index.html){.sidebar-heading .clickable}
    -   [多屏设计](../design/multi-screens.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [最佳实践](../best-practice/index.html){.sidebar-heading .clickable}
    -   [内存优化](../best-practice/memory.html){.sidebar-link}
    -   [常用业务优化](../best-practice/business.html){.sidebar-link}
    -   [启动时延优化](../best-practice/start.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [发布](../publish/index.html){.sidebar-heading .clickable}
    -   [验收标准](../publish/acceptance-criteria.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    [版本说明](../version/index.html){.sidebar-heading .clickable}
    -   [APILevel2](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel2.html){.sidebar-link}
    -   [APILevel3](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel3.html){.sidebar-link}
    -   [APILevel4](https://iot.mi.com/vela/quickapp/zh/guide/version/APILevel4.html){.sidebar-link}
    :::

-   ::: {.section .sidebar-group .depth-0}
    其他

    -   [常见问题](../other/faq.html){.sidebar-link}
    -   [注意事项](../other/tips.html){.sidebar-link}
    :::

::: {.page role="main"}
::: {.theme-default-content .content__default}
# [\#](conditional-compilation.html#条件编译){.header-anchor} 条件编译

基于设备特性的条件编译是一种在编译过程中根据设备类型和屏幕形状等特征来决定哪些代码应该被包含在应用程序中的技术。这项功能适用于跨设备应用开发，其中不同的设备可能需要不同的代码逻辑和界面布局。目前支持条件编译的文件类型有：ux、js。

## [\#](conditional-compilation.html#流程){.header-anchor} 流程

1.  安装 conditional-compilation-webpack-plugin

::: {.language-bash .extra-class}
``` language-bash
npm install conditional-compilation-webpack-plugin -D
```
:::

2.  安装 cross-env

::: {.language-bash .extra-class}
``` language-bash
npm install cross-env -D
```
:::

3.  在项目根目录中增加 quickapp.config.js 文件，并参考如下配置

::: {.language-javascript .extra-class}
``` language-javascript
const ConditionalCompilationWebpackPlugin = require("conditional-compilation-webpack-plugin")

module.exports = {
  plugins: [new ConditionalCompilationWebpackPlugin()]
}
```
:::

4.  根据设备特征，在 package.json 中添加脚本

::: {.language-javascript .extra-class}
``` language-javascript
"scripts": {
  "build:circle": "cross-env DEVICE_TYPE=WATCH SHAPE=CIRCLE aiot build --enable-custom-component",
  "build:rect": "cross-env DEVICE_TYPE=WATCH SHAPE=RECT aiot build --enable-custom-component"
}
```
:::

5.  在代码中使用条件编译，参考如下代码

::: {.language-html .extra-class}
``` language-html
<template>
  <div class="home-page">
    <!-- if true: process.env.DEVICE_TYPE === 'WATCH' && process.env.SHAPE === 'CIRCLE' -->
    <input class="btn bg-red" type="button" value="handleSet" @click="handleSet" />
    <!-- endif -->
    <!-- if true: process.env.DEVICE_TYPE === 'WATCH' && process.env.SHAPE === 'RECT' -->
    <input class="btn bg-blue" type="button" value="handleSet" @click="handleSet" />
    <!-- endif -->
  </div>
</template>

<script>
  export default {
    handleSet() {
      // if true: process.env.DEVICE_TYPE === 'WATCH' && process.env.SHAPE === 'CIRCLE'
      console.log('handleSet shape = circle')
      // endif
      // if true: process.env.DEVICE_TYPE === 'WATCH' && process.env.SHAPE === 'RECT'
      console.log('handleSet shape = rect')
      // endif
    }
  };
</script>

<style>
  .home-page {
    align-items: flex-start;
    justify-content: flex-start;
    padding: 60px;
    position: relative;
  }

  .btn {
    height: 60px;
    width: 360px;
    text-align: center;
    border-radius: 5px;
    margin-bottom: 30px;
    color: #ffffff;
    font-size: 30px;
    background-color: #0faeff;
  }

/* if true: process.env.DEVICE_TYPE === 'WATCH' && process.env.SHAPE === 'CIRCLE' */
  .bg-red {
    background-color: red;
  }
/* endif */
/* if true: process.env.DEVICE_TYPE === 'WATCH' && process.env.SHAPE === 'RECT' */
  .bg-blue {
    background-color: blue;
  }
/* endif */
</style>
```
:::

6.  执行配置好的编译命令

::: {.language-bash .extra-class}
``` language-bash
npm run build:circle
或
npm run build:rect
```
:::
:::

::: page-nav
[ ← [代码示例](samples.html){.prev} ]{.prev} [
[拓展组件](../developer-materials/extension-components.html) → ]{.next}
:::
:::

::: toc
::: on-this-page
快速导航
:::

::: {.vuepress-toc-item .vuepress-toc-h2 .active}
[流程](conditional-compilation.html#流程 "流程")
:::
:::
:::

::: global-ui
:::
:::
